{% extends 'base.html' %}
{% load url from future %}

{% block meta_tags %}
<meta property="og:title" content="UIConnect - {{ collection.name }}"/>
{% endblock %}

{% block content %}
  <div class="span2">

    {% include 'user_side.html' with viewed_user=collection.user %}

    {% if user == collection.user or user.is_staff %}
    <div class="modal hide" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
    <h3 id="myModalLabel">Are you sure you want to delete this collection?</h3>
    </div>
    <div class="modal-body">
    <p>You will not be able to recover this collection in future.</p>
    </div>
    <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
    <a class="btn btn-danger" href="{% url 'collections:delete' collection.id %}">Yes, delete</a>
    </div>
    </div>

    {% endif %}

  </div>

  <div class="span10">
    <h1>{{collection.name}}</h1>

    {% include 'messages.html' %}

    <div class="social" style="text-align: right;">
      <span style="margin-right: 20px;"><span id="span_likes">{{collection.likes.count}}</span> likes this.</span>
      {% if user.is_authenticated %}
      <button id="btn_like" class="btn btn-small" style="margin-top: -5px;">
        {% if user in collection.likes.all %}
        <i class="icon-remove"></i> Unlike
        {% else %}
        <i class="icon-heart"></i> Like this collection
        {% endif %}
      </button>
      {% endif %}
    </div>

    <div>
      {% include 'social.html' %}
    </div>

    {{ collection.description }}

    {% for l in collection.listings.all %}

    <div>
      <h3><a href="{% url 'listings:view' l.id %}">{{l.name}}</a></h3>
      <p>{{l.description}}</p>
      <p>USD {{l.price}}</p>
    </div>

    {% endfor %}


    {% if collection.user == user %}
    <h5>Owner's menu</h5>

    <div class="btn-toolbar" style="margin-bottom: 30px;">
      <div class="btn-group">
        <a class="btn btn-danger" href="#" data-target="#myModal" data-toggle="modal"><i class="icon-trash"></i> Delete Collection</a>
        <a class="btn" href="{% url 'collections:add_listings' collection.id %}"><i class="icon-camera"></i> Manage Items</a>
        <a class="btn" href="{% url 'collections:update' collection.id %}"><i class="icon-pencil"></i> Edit Collection</a>
      </div>
    </div>
    {% endif %}

  </div>
{% endblock %}

{% block js_footer %}
<script>
$(document).ready(function() {
  var likes = {{collection.likes.count}};

  $('#btn_like').click(function(){
    var text = $('#btn_like').html();
    var btn_text = '';
    if (text.indexOf("Unlike") == -1){
      likes += 1;
      btn_text = '<i class="icon-remove"></i> Unlike';
    }
    else{
      likes -= 1;
      btn_text = '<i class="icon-heart"></i> Like this';
    }

    $.get('{% url 'collections:like' collection.id %}', function(data) {
      console.log('Liked.');
    });

    $('#span_likes').html(likes);
    $('#btn_like').html(btn_text);
  });

});
</script>

{% include 'follow/follow_js.html' with viewed_user=collection.user %}

{% endblock %}
